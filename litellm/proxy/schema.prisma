datasource client {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-py"
  binaryTargets = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x", "linux-musl", "linux-musl-openssl-3.0.x"]
}

// Budget / Rate Limits for an org
model LiteLLM_BudgetTable {
  budget_id String @id @default(uuid())
  max_budget Float?
  soft_budget Float?
  max_parallel_requests Int?
  tpm_limit     BigInt?
  rpm_limit     BigInt?
  model_max_budget Json?
  budget_duration String?
  budget_reset_at DateTime?
  created_at    DateTime               @default(now()) @map("created_at")
  created_by String
  updated_at    DateTime               @default(now()) @updatedAt @map("updated_at")
  updated_by String
  account_id String?
  organization LiteLLM_OrganizationTable[] // multiple orgs can have the same budget
  keys LiteLLM_VerificationToken[] // multiple keys can have the same budget
  end_users LiteLLM_EndUserTable[] // multiple end-users can have the same budget
  tags LiteLLM_TagTable[] // multiple tags can have the same budget
  team_membership LiteLLM_TeamMembership[] // budgets of Users within a Team
  organization_membership LiteLLM_OrganizationMembership[] // budgets of Users within a Organization
  @@index([account_id])
}

// Models on proxy
model LiteLLM_CredentialsTable {
  credential_id String @id @default(uuid())
  credential_name String @unique
  credential_values Json
  credential_info Json? 
  created_at    DateTime               @default(now()) @map("created_at")
  created_by String
  updated_at    DateTime               @default(now()) @updatedAt @map("updated_at")
  updated_by String
  account_id String?
  @@index([account_id])
}

// Models on proxy
model LiteLLM_ProxyModelTable {
  model_id String @id @default(uuid())
  model_name String 
  litellm_params Json
  model_info Json? 
  created_at    DateTime               @default(now()) @map("created_at")
  created_by String
  updated_at    DateTime               @default(now()) @updatedAt @map("updated_at")
  updated_by String
  account_id String?
  @@index([account_id])
}


// Agents on proxy
model LiteLLM_AgentsTable {
  agent_id String @id @default(uuid())
  agent_name String @unique
  litellm_params Json?
  agent_card_params Json
  agent_access_groups String[]       @default([])
  created_at    DateTime               @default(now()) @map("created_at")
  created_by String
  updated_at    DateTime               @default(now()) @updatedAt @map("updated_at")
  updated_by String
  account_id String?
  @@index([account_id])
}

model LiteLLM_OrganizationTable {
		organization_id String @id @default(uuid())
    organization_alias  String
    budget_id String
    metadata  Json  @default("{}")
    models     String[]
    spend      Float    @default(0.0)
    model_spend      Json @default("{}")
    object_permission_id String?
    created_at    DateTime               @default(now()) @map("created_at")
    created_by String
    updated_at    DateTime               @default(now()) @updatedAt @map("updated_at")
    updated_by String
    litellm_budget_table LiteLLM_BudgetTable?   @relation(fields: [budget_id], references: [budget_id])
    teams LiteLLM_TeamTable[] 
    users LiteLLM_UserTable[]
    keys LiteLLM_VerificationToken[]
    members LiteLLM_OrganizationMembership[] @relation("OrganizationToMembership")
    object_permission LiteLLM_ObjectPermissionTable?   @relation(fields: [object_permission_id], references: [object_permission_id])
    account_id String?
    alchemi_account Alchemi_AccountTable? @relation(fields: [account_id], references: [account_id])
    @@index([account_id])
}

// Model info for teams, just has model aliases for now.
model LiteLLM_ModelTable {
  id Int @id @default(autoincrement())
  model_aliases Json? @map("aliases")
  created_at    DateTime               @default(now()) @map("created_at")
  created_by String
  updated_at    DateTime               @default(now()) @updatedAt @map("updated_at")
  updated_by String
  team LiteLLM_TeamTable?
}


// Assign prod keys to groups, not individuals 
model LiteLLM_TeamTable {
		team_id    String @id @default(uuid())
    team_alias  String? 
    organization_id String?
    object_permission_id String?
    admins String[]
    members String[]
    members_with_roles Json @default("{}")
    metadata  Json  @default("{}")
    max_budget Float?
    soft_budget Float?
    spend      Float    @default(0.0)
    models     String[]
    max_parallel_requests Int?
    tpm_limit     BigInt?
    rpm_limit     BigInt?
    budget_duration String? 
    budget_reset_at DateTime?
    blocked Boolean @default(false)
    created_at    DateTime               @default(now()) @map("created_at")
    updated_at    DateTime               @default(now()) @updatedAt @map("updated_at")
    model_spend      Json @default("{}")
    model_max_budget Json @default("{}")
    router_settings  Json? @default("{}")
    team_member_permissions String[] @default([])
    access_group_ids String[] @default([])
    policies         String[] @default([])
    model_id Int? @unique // id for LiteLLM_ModelTable -> stores team-level model aliases
    allow_team_guardrail_config Boolean @default(false) // if true, team admin can configure guardrails for this team
    litellm_organization_table LiteLLM_OrganizationTable?   @relation(fields: [organization_id], references: [organization_id])
    litellm_model_table LiteLLM_ModelTable? @relation(fields: [model_id], references: [id])
    object_permission LiteLLM_ObjectPermissionTable?   @relation(fields: [object_permission_id], references: [object_permission_id])
    account_id String?
    @@index([account_id])
}

// Audit table for deleted teams - preserves spend and team information for historical tracking
model LiteLLM_DeletedTeamTable {
    id                      String   @id @default(uuid())
    team_id                 String   // Original team_id
    team_alias              String?
    organization_id         String?
    object_permission_id    String?
    admins                  String[]
    members                 String[]
    members_with_roles      Json     @default("{}")
    metadata                Json     @default("{}")
    max_budget              Float?
    soft_budget             Float?
    spend                   Float    @default(0.0)
    models                  String[]
    max_parallel_requests   Int?
    tpm_limit               BigInt?
    rpm_limit               BigInt?
    budget_duration         String?
    budget_reset_at         DateTime?
    blocked                 Boolean  @default(false)
    model_spend             Json     @default("{}")
    model_max_budget        Json     @default("{}")
    router_settings  Json? @default("{}")
    team_member_permissions String[] @default([])
    access_group_ids String[] @default([])
    policies                String[] @default([])
    model_id                Int?     // id for LiteLLM_ModelTable -> stores team-level model aliases
    allow_team_guardrail_config Boolean @default(false)

    // Original timestamps from team creation/updates
    created_at              DateTime? @map("created_at")
    updated_at              DateTime? @map("updated_at")
    
    // Deletion metadata
    deleted_at              DateTime  @default(now()) @map("deleted_at")
    deleted_by              String?   @map("deleted_by") // User who deleted the team
    deleted_by_api_key      String?   @map("deleted_by_api_key") // API key hash that performed the deletion
    litellm_changed_by      String?   @map("litellm_changed_by") // From litellm-changed-by header if provided
    
    @@index([team_id])
    @@index([deleted_at])
    @@index([organization_id])
    @@index([team_alias])
    @@index([created_at])
    account_id String?
    @@index([account_id])
}

// Track spend, rate limit, budget Users
model LiteLLM_UserTable {
		user_id    String @id
    user_alias String? 
    team_id    String?
    sso_user_id String? @unique
    organization_id String?
    object_permission_id String?
    password  String?
    teams    String[] @default([])
    user_role  String?
		max_budget Float?
    spend      Float    @default(0.0)
    user_email    String?
    models     String[]
    metadata  Json  @default("{}")
    max_parallel_requests Int?
    tpm_limit     BigInt?
    rpm_limit     BigInt?
    budget_duration String? 
    budget_reset_at DateTime?
    allowed_cache_controls String[] @default([])
    policies         String[] @default([])
    model_spend      Json @default("{}")
    model_max_budget Json @default("{}")
    created_at      DateTime?               @default(now()) @map("created_at")
    updated_at      DateTime?               @default(now()) @updatedAt @map("updated_at")

    // relations
    litellm_organization_table LiteLLM_OrganizationTable?                   @relation(fields: [organization_id], references: [organization_id])
    organization_memberships LiteLLM_OrganizationMembership[]
    invitations_created LiteLLM_InvitationLink[] @relation("CreatedBy")
    invitations_updated LiteLLM_InvitationLink[] @relation("UpdatedBy")
    invitations_user    LiteLLM_InvitationLink[] @relation("UserId")
    object_permission LiteLLM_ObjectPermissionTable?   @relation(fields: [object_permission_id], references: [object_permission_id])
    account_id String?
    @@index([account_id])
}

model LiteLLM_ObjectPermissionTable {
  object_permission_id  String         @id @default(uuid())
  mcp_servers           String[]       @default([])
  mcp_access_groups     String[]       @default([])
  mcp_tool_permissions  Json?          // Tool-level permissions for MCP servers. Format: {"server_id": ["tool_name_1", "tool_name_2"]}
  vector_stores         String[]       @default([])
  agents                String[]       @default([])
  agent_access_groups   String[]       @default([])
  teams                 LiteLLM_TeamTable[]
  verification_tokens   LiteLLM_VerificationToken[]
  organizations         LiteLLM_OrganizationTable[]
  users                 LiteLLM_UserTable[]
  account_id String?
}

// Holds the MCP server configuration 
model LiteLLM_MCPServerTable {
  server_id    String         @id @default(uuid())
  server_name  String?
  alias        String?
  description  String?
  url          String?
  transport    String         @default("sse")
  auth_type    String?        
  credentials  Json?          @default("{}")
  created_at   DateTime?      @default(now()) @map("created_at")
  created_by   String?
  updated_at   DateTime?      @default(now()) @updatedAt @map("updated_at")
  updated_by   String?
  mcp_info     Json?          @default("{}")
  mcp_access_groups String[]
  allowed_tools String[]      @default([])
  extra_headers String[]    @default([])
  static_headers Json?        @default("{}")
  // Health check status
  status       String?        @default("unknown")
  last_health_check DateTime?
  health_check_error String?
  // Stdio-specific fields
  command      String?
  args         String[]       @default([])
  env          Json?          @default("{}")
  authorization_url  String?
  token_url          String?
  registration_url   String?
  allow_all_keys Boolean @default(false)
  available_on_public_internet Boolean @default(false)
  account_id String?
  @@index([account_id])
}

// Generate Tokens for Proxy
model LiteLLM_VerificationToken {
    token      String   @id
    key_name   String?
    key_alias   String?
    soft_budget_cooldown Boolean @default(false) // key-level state on if budget alerts need to be cooled down
    spend      Float    @default(0.0)
    expires    DateTime?
    models     String[]
    aliases    Json  @default("{}")
    config     Json  @default("{}")
    router_settings Json? @default("{}")
    user_id    String?
    team_id    String?
    permissions Json @default("{}")
    max_parallel_requests Int?
    metadata   Json  @default("{}")
    blocked Boolean?
    tpm_limit     BigInt?
    rpm_limit     BigInt?
    max_budget Float?    
    budget_duration String? 
    budget_reset_at DateTime?
    allowed_cache_controls String[] @default([])
    allowed_routes   String[] @default([])
    policies         String[] @default([])
    access_group_ids String[] @default([])
    model_spend      Json @default("{}")
    model_max_budget Json @default("{}")
    budget_id String?
    organization_id String?
    object_permission_id String?
    created_at      DateTime?               @default(now()) @map("created_at")
    created_by String?
    updated_at      DateTime?               @default(now()) @updatedAt @map("updated_at")
    updated_by String?
    rotation_count   Int?       @default(0) // Number of times key has been rotated
    auto_rotate      Boolean?   @default(false) // Whether this key should be auto-rotated
    rotation_interval String?   // How often to rotate (e.g., "30d", "90d")
    last_rotation_at DateTime?  // When this key was last rotated
    key_rotation_at  DateTime?  // When this key should next be rotated
    litellm_budget_table LiteLLM_BudgetTable?   @relation(fields: [budget_id], references: [budget_id])
    litellm_organization_table LiteLLM_OrganizationTable?   @relation(fields: [organization_id], references: [organization_id])
    object_permission LiteLLM_ObjectPermissionTable?   @relation(fields: [object_permission_id], references: [object_permission_id])
    account_id String?

    // SELECT COUNT(*) FROM (SELECT "public"."LiteLLM_VerificationToken"."token" FROM "public"."LiteLLM_VerificationToken" WHERE ("public"."LiteLLM_VerificationToken"."user_id" = $1 AND ("public"."LiteLLM_VerificationToken"."team_id" IS NULL OR "public"."LiteLLM_VerificationToken"."team_id" <> $2)) OFFSET $3 ) AS "sub"
    // SELECT ... FROM "public"."LiteLLM_VerificationToken" WHERE "public"."LiteLLM_VerificationToken"."user_id" = $1 OFFSET $2
    @@index([user_id, team_id])

    // SELECT ... FROM "public"."LiteLLM_VerificationToken" WHERE "public"."LiteLLM_VerificationToken"."team_id" = $1 OFFSET $2
    @@index([team_id])

    // SELECT ... FROM "public"."LiteLLM_VerificationToken" WHERE (("public"."LiteLLM_VerificationToken"."expires" IS NULL OR "public"."LiteLLM_VerificationToken"."expires" > $1) AND "public"."LiteLLM_VerificationToken"."budget_reset_at" < $2) OFFSET $3
    @@index([budget_reset_at, expires])
    @@index([account_id])
}

// Deprecated keys during grace period - allows old key to work until revoke_at
model LiteLLM_DeprecatedVerificationToken {
    id               String   @id @default(uuid())
    token            String   // Hashed old key
    active_token_id  String   // Current token hash in LiteLLM_VerificationToken
    revoke_at        DateTime // When the old key stops working
    created_at       DateTime @default(now()) @map("created_at")

    @@unique([token])
    @@index([token, revoke_at])
    @@index([revoke_at])
}

// Audit table for deleted keys - preserves spend and key information for historical tracking
model LiteLLM_DeletedVerificationToken {
    id                      String   @id @default(uuid())
    token                   String   // Original token (hashed)
    key_name                String?
    key_alias               String?
    soft_budget_cooldown    Boolean  @default(false)
    spend                   Float    @default(0.0)
    expires                 DateTime?
    models                  String[]
    aliases                 Json     @default("{}")
    config                  Json     @default("{}")
    user_id                 String?
    team_id                 String?
    permissions             Json     @default("{}")
    max_parallel_requests   Int?
    metadata                Json     @default("{}")
    blocked                 Boolean?
    tpm_limit               BigInt?
    rpm_limit               BigInt?
    max_budget              Float?
    budget_duration         String?
    budget_reset_at         DateTime?
    allowed_cache_controls  String[] @default([])
    allowed_routes          String[] @default([])
    policies                String[] @default([])
    access_group_ids String[] @default([])
    model_spend             Json     @default("{}")
    model_max_budget        Json     @default("{}")
    router_settings  Json? @default("{}")
    budget_id               String?
    organization_id         String?
    object_permission_id    String?
    created_at              DateTime? // Original creation timestamp
    created_by              String?   // Original creator
    updated_at              DateTime? // Last update timestamp before deletion
    updated_by              String?   // Last user who updated before deletion
    rotation_count          Int?      @default(0)
    auto_rotate             Boolean?  @default(false)
    rotation_interval       String?
    last_rotation_at        DateTime?
    key_rotation_at         DateTime?
    
    // Deletion metadata
    deleted_at              DateTime  @default(now()) @map("deleted_at")
    deleted_by              String?   @map("deleted_by") // User who deleted the key
    deleted_by_api_key      String?   @map("deleted_by_api_key") // API key hash that performed the deletion
    litellm_changed_by      String?   @map("litellm_changed_by") // From litellm-changed-by header if provided
    
    @@index([token])
    @@index([deleted_at])
    @@index([user_id])
    @@index([team_id])
    @@index([organization_id])
    @@index([key_alias])
    @@index([created_at])
    account_id String?
    @@index([account_id])
}

model LiteLLM_EndUserTable {
  user_id String @id
  alias    String? // admin-facing alias
  spend      Float    @default(0.0)
  allowed_model_region String? // require all user requests to use models in this specific region
  default_model String? // use along with 'allowed_model_region'. if no available model in region, default to this model.
  budget_id String?
  litellm_budget_table LiteLLM_BudgetTable?   @relation(fields: [budget_id], references: [budget_id])
  blocked Boolean @default(false)
  account_id String?
  @@index([account_id])
}

// Track tags with budgets and spend
model LiteLLM_TagTable {
  tag_name String @id
  description String?
  models String[]
  model_info Json? // maps model_id to model_name
  spend Float @default(0.0)
  budget_id String?
  litellm_budget_table LiteLLM_BudgetTable? @relation(fields: [budget_id], references: [budget_id])
  created_at DateTime @default(now()) @map("created_at")
  created_by String?
  updated_at DateTime @default(now()) @updatedAt @map("updated_at")
  account_id String?
  @@index([account_id])
}

// store proxy config.yaml
model LiteLLM_Config {
  param_name String @id
  param_value Json?
  account_id String?
  @@index([account_id])
}

// View spend, model, api_key per request
model LiteLLM_SpendLogs {
  request_id          String @id
  call_type           String
  api_key             String  @default ("") // Hashed API Token. Not the actual Virtual Key. Equivalent to 'token' column in LiteLLM_VerificationToken
  spend               Float    @default(0.0)
  total_tokens        Int     @default(0)
  prompt_tokens       Int     @default(0)
  completion_tokens   Int     @default(0)
  startTime           DateTime // Assuming start_time is a DateTime field
  endTime             DateTime // Assuming end_time is a DateTime field
  completionStartTime DateTime? // Assuming completionStartTime is a DateTime field
  model               String   @default("")
  model_id            String?   @default("") // the model id stored in proxy model db
  model_group         String?   @default("") // public model_name / model_group
  custom_llm_provider String?   @default("") // litellm used custom_llm_provider
  api_base            String?   @default("")
  user                String?   @default("")
  metadata            Json?     @default("{}")
  cache_hit           String?   @default("")
  cache_key           String?   @default("")
  request_tags        Json?     @default("[]")
  team_id             String? 
  organization_id     String?
  end_user            String?
  requester_ip_address String?
  messages            Json?     @default("{}")
  response            Json?     @default("{}")
  session_id          String?
  status              String?
  mcp_namespaced_tool_name String? 
  agent_id            String?
  proxy_server_request Json?     @default("{}")
  @@index([startTime])
  @@index([end_user])
  @@index([session_id])
  account_id String?
  @@index([account_id])
}

// View spend, model, api_key per request
model LiteLLM_ErrorLogs {
  request_id          String   @id @default(uuid())
  startTime           DateTime // Assuming start_time is a DateTime field
  endTime             DateTime // Assuming end_time is a DateTime field
  api_base            String   @default("") 
  model_group         String   @default("")      // public model_name / model_group
  litellm_model_name  String   @default("")      // model passed to litellm
  model_id            String   @default("")      // ID of model in ProxyModelTable
  request_kwargs      Json     @default("{}")
  exception_type      String   @default("")
  exception_string    String   @default("")
  status_code         String   @default("")
  account_id String?
  @@index([account_id])
}

// Beta - allow team members to request access to a model
model LiteLLM_UserNotifications {
  request_id          String @id
  user_id             String 
  models              String[]
  justification       String
  status              String // approved, disapproved, pending
}

model LiteLLM_TeamMembership {
  // Use this table to track the Internal User's Spend within a Team + Set Budgets, rpm limits for the user within the team
  user_id    String
  team_id    String
  spend      Float    @default(0.0)
  budget_id String?
  litellm_budget_table LiteLLM_BudgetTable?   @relation(fields: [budget_id], references: [budget_id])
  account_id String?
  @@id([user_id, team_id])
}

model LiteLLM_OrganizationMembership {
  // Use this table to track Internal User and Organization membership. Helps tracking a users role within an Organization
  user_id         String
  organization_id String
  user_role       String?
  spend           Float?    @default(0.0)
  budget_id       String?
  created_at      DateTime?               @default(now()) @map("created_at")
  updated_at      DateTime?               @default(now()) @updatedAt @map("updated_at")

  // relations
  user LiteLLM_UserTable @relation(fields: [user_id], references: [user_id])
  organization LiteLLM_OrganizationTable @relation("OrganizationToMembership", fields: [organization_id], references: [organization_id])
  litellm_budget_table LiteLLM_BudgetTable?   @relation(fields: [budget_id], references: [budget_id])
  account_id String?



  @@id([user_id, organization_id])
  @@unique([user_id, organization_id])
}

model LiteLLM_InvitationLink {
  // use this table to track invite links sent by admin for people to join the proxy
  id String   @id @default(uuid())
  user_id String
  is_accepted Boolean @default(false)
  accepted_at DateTime? // when link is claimed (user successfully onboards via link)
  expires_at  DateTime // till when is link valid
  created_at DateTime // when did admin create the link
  created_by String // who created the link
  updated_at DateTime // when was invite status updated
  updated_by String // who updated the status (admin/user who accepted invite)

  // Relations
  liteLLM_user_table_user    LiteLLM_UserTable  @relation("UserId", fields: [user_id], references: [user_id])
  liteLLM_user_table_created LiteLLM_UserTable  @relation("CreatedBy", fields: [created_by], references: [user_id])
  liteLLM_user_table_updated LiteLLM_UserTable  @relation("UpdatedBy", fields: [updated_by], references: [user_id])
  account_id String?
}


model LiteLLM_AuditLog {
  id                 String   @id @default(uuid())
  updated_at         DateTime @default(now())
  changed_by         String   @default("")   // user or system that performed the action
  changed_by_api_key String   @default("")   // api key hash that performed the action
  action             String      // create, update, delete
  table_name         String      // on of  LitellmTableNames.TEAM_TABLE_NAME, LitellmTableNames.USER_TABLE_NAME, LitellmTableNames.PROXY_MODEL_TABLE_NAME,
  object_id          String      // id of the object being audited. This can be the key id, team id, user id, model id
  before_value       Json?       // value of the row 
  updated_values     Json?       // value of the row after change
  account_id String?
  @@index([account_id])
}

// Track daily user spend metrics per model and key
model LiteLLM_DailyUserSpend {
  id                  String   @id @default(uuid())
  user_id             String? 
  date                String
  api_key             String   
  model               String?
  model_group         String?  
  custom_llm_provider String?
  mcp_namespaced_tool_name String?
  endpoint               String?
  prompt_tokens       BigInt      @default(0)
  completion_tokens   BigInt      @default(0)
  cache_read_input_tokens     BigInt      @default(0)
  cache_creation_input_tokens BigInt      @default(0)
  spend               Float    @default(0.0)
  api_requests        BigInt      @default(0)
  successful_requests BigInt      @default(0)
  failed_requests     BigInt      @default(0)
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt

  @@unique([user_id, date, api_key, model, custom_llm_provider, mcp_namespaced_tool_name, endpoint])
  @@index([date])
  @@index([user_id])
  @@index([api_key])
  @@index([model])
  @@index([mcp_namespaced_tool_name])
  @@index([endpoint])
  account_id String?
}

// Track daily organization spend metrics per model and key
model LiteLLM_DailyOrganizationSpend {
  id                  String   @id @default(uuid())
  organization_id     String?
  date                String
  api_key             String   
  model               String?
  model_group         String?  
  custom_llm_provider String?
  mcp_namespaced_tool_name String?
  endpoint               String?
  prompt_tokens       BigInt      @default(0)
  completion_tokens   BigInt      @default(0)
  cache_read_input_tokens     BigInt      @default(0)
  cache_creation_input_tokens BigInt      @default(0)
  spend               Float    @default(0.0)
  api_requests        BigInt      @default(0)
  successful_requests BigInt      @default(0)
  failed_requests     BigInt      @default(0)
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt

  @@unique([organization_id, date, api_key, model, custom_llm_provider, mcp_namespaced_tool_name, endpoint])
  @@index([date])
  @@index([organization_id])
  @@index([api_key])
  @@index([model])
  @@index([mcp_namespaced_tool_name])
  @@index([endpoint])
  account_id String?
}

// Track daily end user (customer) spend metrics per model and key
model LiteLLM_DailyEndUserSpend {
  id                  String   @id @default(uuid())
  end_user_id         String?
  date                String
  api_key             String   
  model               String?
  model_group         String?  
  custom_llm_provider String?
  mcp_namespaced_tool_name String?
  endpoint               String?
  prompt_tokens       BigInt      @default(0)
  completion_tokens   BigInt      @default(0)
  cache_read_input_tokens     BigInt      @default(0)
  cache_creation_input_tokens BigInt      @default(0)
  spend               Float    @default(0.0)
  api_requests        BigInt      @default(0)
  successful_requests BigInt      @default(0)
  failed_requests     BigInt      @default(0)
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt
  @@unique([end_user_id, date, api_key, model, custom_llm_provider, mcp_namespaced_tool_name, endpoint])
  @@index([date])
  @@index([end_user_id])
  @@index([api_key])
  @@index([model])
  @@index([mcp_namespaced_tool_name])
  @@index([endpoint])
  account_id String?
}

// Track daily agent spend metrics per model and key
model LiteLLM_DailyAgentSpend {
  id                  String   @id @default(uuid())
  agent_id            String?
  date                String
  api_key             String   
  model               String?
  model_group         String?  
  custom_llm_provider String?
  mcp_namespaced_tool_name String?
  endpoint               String?
  prompt_tokens       BigInt      @default(0)
  completion_tokens   BigInt      @default(0)
  cache_read_input_tokens     BigInt      @default(0)
  cache_creation_input_tokens BigInt      @default(0)
  spend               Float    @default(0.0)
  api_requests        BigInt      @default(0)
  successful_requests BigInt      @default(0)
  failed_requests     BigInt      @default(0)
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt
  @@unique([agent_id, date, api_key, model, custom_llm_provider, mcp_namespaced_tool_name, endpoint])
  @@index([date])
  @@index([agent_id])
  @@index([api_key])
  @@index([model])
  @@index([mcp_namespaced_tool_name])
  @@index([endpoint])
  account_id String?
}

// Track daily team spend metrics per model and key
model LiteLLM_DailyTeamSpend {
  id                  String   @id @default(uuid())
  team_id             String?
  date                String
  api_key             String   
  model               String?
  model_group         String?  
  custom_llm_provider String?
  mcp_namespaced_tool_name String?
  endpoint               String?
  prompt_tokens       BigInt      @default(0)
  completion_tokens   BigInt      @default(0)
  cache_read_input_tokens     BigInt      @default(0)
  cache_creation_input_tokens BigInt      @default(0)
  spend               Float    @default(0.0)
  api_requests        BigInt      @default(0)
  successful_requests BigInt      @default(0)
  failed_requests     BigInt      @default(0)
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt

  @@unique([team_id, date, api_key, model, custom_llm_provider, mcp_namespaced_tool_name, endpoint])
  @@index([date])
  @@index([team_id])
  @@index([api_key])
  @@index([model])
  @@index([mcp_namespaced_tool_name])
  @@index([endpoint])
  account_id String?
}

// Track daily team spend metrics per model and key
model LiteLLM_DailyTagSpend {
  id                  String   @id @default(uuid())
  request_id          String?
  tag                 String?   
  date                String
  api_key             String   
  model               String?
  model_group         String?  
  custom_llm_provider String?
  mcp_namespaced_tool_name String?
  endpoint               String?
  prompt_tokens       BigInt      @default(0)
  completion_tokens   BigInt      @default(0)
  cache_read_input_tokens     BigInt      @default(0)
  cache_creation_input_tokens BigInt      @default(0)
  spend               Float    @default(0.0)
  api_requests        BigInt      @default(0)
  successful_requests BigInt      @default(0)
  failed_requests     BigInt      @default(0)
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt

  @@unique([tag, date, api_key, model, custom_llm_provider, mcp_namespaced_tool_name, endpoint])
  @@index([date])
  @@index([tag])
  @@index([api_key])
  @@index([model])
  @@index([mcp_namespaced_tool_name])
  @@index([endpoint])
  account_id String?
}


// Track the status of cron jobs running. Only allow one pod to run the job at a time
model LiteLLM_CronJob {
  cronjob_id            String   @id @default(cuid()) // Unique ID for the record
  pod_id         String   // Unique identifier for the pod acting as the leader
  status        JobStatus @default(INACTIVE) // Status of the cron job (active or inactive)
  last_updated   DateTime @default(now()) // Timestamp for the last update of the cron job record
  ttl           DateTime // Time when the leader's lease expires
}

enum JobStatus {
  ACTIVE
  INACTIVE
}

model LiteLLM_ManagedFileTable {
  id String @id @default(uuid())
  unified_file_id String @unique // The base64 encoded unified file ID
  file_object Json? // Stores the OpenAIFileObject
  model_mappings Json
  flat_model_file_ids String[]  @default([]) // Flat list of model file id's - for faster querying of model id -> unified file id
  storage_backend String? // Storage backend name (e.g., "azure_storage", "gcs", "default")
  storage_url String? // The actual storage URL where the file is stored
  created_at DateTime @default(now())
  created_by String? 
  updated_at DateTime @updatedAt
  updated_by String?

  @@index([unified_file_id])
}

model LiteLLM_ManagedObjectTable { // for batches or finetuning jobs which use the 
  id String @id @default(uuid())
  unified_object_id String @unique // The base64 encoded unified file ID
  model_object_id String @unique // the id returned by the backend API provider 
  file_object Json // Stores the OpenAIFileObject
  file_purpose String // either 'batch' or 'fine-tune'
  status String? // check if batch cost has been tracked  
  created_at DateTime @default(now())
  created_by String?
  updated_at DateTime @updatedAt
  updated_by String? 

  @@index([unified_object_id])
  @@index([model_object_id])
}

model LiteLLM_ManagedVectorStoreTable {
  id String @id @default(uuid())
  unified_resource_id String @unique // The base64 encoded unified vector store ID
  resource_object Json? // Stores the VectorStoreCreateResponse
  model_mappings Json // Maps model_id -> provider_vector_store_id
  flat_model_resource_ids String[] @default([]) // Flat list of provider vector store IDs for faster querying
  storage_backend String? // Storage backend name (if applicable)
  storage_url String? // Storage URL (if applicable)
  created_at DateTime @default(now())
  created_by String?
  updated_at DateTime @updatedAt
  updated_by String?

  @@index([unified_resource_id])
}

model LiteLLM_ManagedVectorStoresTable {
  vector_store_id String @id
  custom_llm_provider String
  vector_store_name String?
  vector_store_description String?
  vector_store_metadata Json?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  litellm_credential_name String?
  litellm_params Json?
  team_id String?
  user_id String?
  
  @@index([team_id])
  @@index([user_id])
}

// Guardrails table for storing guardrail configurations
model LiteLLM_GuardrailsTable {
  guardrail_id String @id @default(uuid())
  guardrail_name String @unique
  litellm_params Json
  guardrail_info Json?
  team_id String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  account_id String?
  @@index([account_id])
}

// Prompt table for storing prompt configurations
model LiteLLM_PromptTable {
  id String @id @default(uuid())
  prompt_id String
  version Int @default(1)
  litellm_params Json
  prompt_info Json?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@unique([prompt_id, version])
  @@index([prompt_id])
  account_id String?
}

model LiteLLM_HealthCheckTable {
  health_check_id String @id @default(uuid())
  model_name String
  model_id String?
  status String
  healthy_count Int @default(0)
  unhealthy_count Int @default(0)
  error_message String?
  response_time_ms Float?
  details Json?
  checked_by String?
  checked_at DateTime @default(now())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([model_name])
  @@index([checked_at])
  @@index([status])
  account_id String?
}

// Search Tools table for storing search tool configurations
model LiteLLM_SearchToolsTable {
  search_tool_id String @id @default(uuid())
  search_tool_name String @unique
  litellm_params Json
  search_tool_info Json?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  account_id String?
  @@index([account_id])
}

// SSO configuration table
model LiteLLM_SSOConfig {
  id String @id @default("sso_config")
  sso_settings Json
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  account_id String?
}

model LiteLLM_ManagedVectorStoreIndexTable {
  id String @id @default(uuid())
  index_name String @unique
  litellm_params Json
  index_info Json?
  created_at DateTime @default(now())
  created_by String?
  updated_at DateTime @updatedAt
  updated_by String?
}

// Cache configuration table
model LiteLLM_CacheConfig {
  id String @id @default("cache_config")
  cache_settings Json
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  account_id String?
}

// UI Settings configuration table
model LiteLLM_UISettings {
  id String @id @default("ui_settings")
  ui_settings Json
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  account_id String?
}

// Skills table for storing LiteLLM-managed skills
model LiteLLM_SkillsTable {
  skill_id       String   @id @default(uuid())
  display_title  String?
  description    String?
  instructions   String?  // The skill instructions/prompt (from SKILL.md)
  source         String   @default("custom")  // "custom" or "anthropic"
  latest_version String?
  file_content   Bytes?   // Binary content of the skill files (zip)
  file_name      String?  // Original filename
  file_type      String?  // MIME type (e.g., "application/zip")
  metadata       Json?    @default("{}")
  created_at     DateTime @default(now())
  created_by     String?
  updated_at     DateTime @default(now()) @updatedAt
  updated_by     String?
  account_id String?
}

// Policy table for storing guardrail policies
model LiteLLM_PolicyTable {
  policy_id        String    @id @default(uuid())
  policy_name      String    @unique
  inherit          String?   // Name of parent policy to inherit from
  description      String?
  guardrails_add   String[]  @default([])
  guardrails_remove String[] @default([])
  condition        Json?     @default("{}")  // Policy conditions (e.g., model matching)
  pipeline         Json?     // Optional guardrail pipeline (mode + steps[])
  created_at       DateTime  @default(now())
  created_by       String?
  updated_at       DateTime  @default(now()) @updatedAt
  updated_by       String?
  account_id String?
  @@index([account_id])
}

// Policy attachment table for defining where policies apply
model LiteLLM_PolicyAttachmentTable {
  attachment_id    String    @id @default(uuid())
  policy_name      String    // Name of the policy to attach
  scope            String?   // Use '*' for global scope
  teams            String[]  @default([])  // Team aliases or patterns
  keys             String[]  @default([])  // Key aliases or patterns
  models           String[]  @default([])  // Model names or patterns
  tags             String[]  @default([])  // Tag patterns (e.g., ["healthcare", "prod-*"])
  created_at       DateTime  @default(now())
  created_by       String?
  updated_at       DateTime  @default(now()) @updatedAt
  updated_by       String?
  account_id String?
  @@index([account_id])
}

//Unified Access Groups table for storing unified access groups
model LiteLLM_AccessGroupTable {
  access_group_id    String   @id @default(uuid())
  access_group_name  String   @unique
  description        String?
  
  // Resource memberships - explicit arrays per type
  access_model_names        String[] @default([])
  access_mcp_server_ids   String[] @default([])
  access_agent_ids        String[] @default([])

  assigned_team_ids         String[] @default([])
  assigned_key_ids          String[] @default([])

  created_at         DateTime @default(now())
  created_by         String?
  updated_at         DateTime @default(now()) @updatedAt
  updated_by         String?
  account_id String?
  @@index([account_id])
}

// ============================================
// Alchemi Studio Console - Multi-Tenant Tables
// ============================================

model Alchemi_AccountTable {
    account_id    String   @id @default(uuid())
    account_name  String   @unique
    account_alias String?
    domain        String?  @unique
    status        String   @default("active")
    metadata      Json     @default("{}")
    max_budget    Float?
    spend         Float    @default(0.0)
    created_at    DateTime @default(now())
    created_by    String?
    updated_at    DateTime @default(now()) @updatedAt
    organizations LiteLLM_OrganizationTable[]
    admins        Alchemi_AccountAdminTable[]
    sso_config    Alchemi_AccountSSOConfig?
    subscriptions Alchemi_SubscriptionTable[]
    memberships   Alchemi_AccountMembershipTable[]
    @@index([domain])
    @@index([status])
}

model Alchemi_AccountAdminTable {
    id          String   @id @default(uuid())
    account_id  String
    user_email  String
    role        String   @default("account_admin")
    created_at  DateTime @default(now())
    created_by  String?
    updated_at  DateTime @default(now()) @updatedAt
    account     Alchemi_AccountTable @relation(fields: [account_id], references: [account_id])
    @@unique([account_id, user_email])
    @@index([user_email])
}

model Alchemi_AccountSSOConfig {
    id           String   @id @default(uuid())
    account_id   String   @unique
    sso_provider String?
    sso_settings Json     @default("{}")
    enabled      Boolean  @default(false)
    created_at   DateTime @default(now())
    updated_at   DateTime @default(now()) @updatedAt
    account      Alchemi_AccountTable @relation(fields: [account_id], references: [account_id])
}

// ============================================
// Alchemi Centralized Platform - Subscriptions & Plans
// ============================================

model Alchemi_SubscriptionPlanTable {
    id            String   @id @default(uuid())
    plan_name     String
    display_name  String?
    description   String?
    price_monthly Float?
    price_yearly  Float?
    currency      String   @default("USD")
    features      Json     @default("{}")
    limits        Json     @default("{}")
    is_active     Boolean  @default(true)
    created_at    DateTime @default(now())
    updated_at    DateTime @default(now()) @updatedAt
    subscriptions Alchemi_SubscriptionTable[]
    @@index([is_active])
    @@index([plan_name])
}

model Alchemi_SubscriptionTable {
    id                     String   @id @default(uuid())
    account_id             String?
    plan_id                String
    system_subscription_id String?
    quantity               Int      @default(1)
    start_date             DateTime
    end_date               DateTime?
    is_active              Boolean  @default(true)
    razorpay_response      Json?
    created_by             String?
    updated_by             String?
    created_at             DateTime @default(now())
    updated_at             DateTime @default(now()) @updatedAt
    account                Alchemi_AccountTable?         @relation(fields: [account_id], references: [account_id])
    plan                   Alchemi_SubscriptionPlanTable @relation(fields: [plan_id], references: [id])
    quotas                 Alchemi_AccountQuotaTable[]
    @@index([account_id])
    @@index([plan_id])
    @@index([is_active])
    @@index([system_subscription_id])
}

// ============================================
// Alchemi Centralized Platform - Account Membership & Quotas
// ============================================

model Alchemi_AccountMembershipTable {
    id                 String    @id @default(uuid())
    account_id         String?
    user_id            String
    app_role           String    @default("member")
    is_active          Boolean   @default(true)
    joined_at          DateTime  @default(now())
    invited_by         String?
    last_active_at     DateTime?
    team_id            String?
    tenant_preferences Json      @default("{}")
    created_at         DateTime  @default(now())
    updated_at         DateTime  @default(now()) @updatedAt
    account            Alchemi_AccountTable? @relation(fields: [account_id], references: [account_id])
    @@unique([account_id, user_id])
    @@index([account_id])
    @@index([user_id])
    @@index([team_id])
    @@index([is_active])
}

model Alchemi_AccountQuotaTable {
    id                     String   @id @default(uuid())
    account_id             String?
    subscription_id        String?
    product_code           String?
    feature_code           String?
    unit                   String   @default("credits")
    included               Float    @default(0)
    used                   Float    @default(0)
    overage_used           Float    @default(0)
    overage_limit          Float    @default(0)
    reset_policy           String   @default("MONTHLY")
    rollover_enabled       Boolean  @default(false)
    rollover_cap           Float    @default(0)
    rollover_from_previous Float    @default(0)
    period_start           DateTime
    period_end             DateTime
    is_active              Boolean  @default(true)
    created_at             DateTime @default(now())
    updated_at             DateTime @default(now()) @updatedAt
    subscription           Alchemi_SubscriptionTable? @relation(fields: [subscription_id], references: [id])
    @@index([account_id])
    @@index([subscription_id])
    @@index([unit])
    @@index([product_code])
    @@index([is_active])
    @@index([account_id, unit, is_active])
}

// ============================================
// Alchemi Centralized Platform - Roles & Permissions (CASL)
// ============================================

model Alchemi_RoleTable {
    id               String   @id @default(uuid())
    account_id       String?
    name             String
    type             String?
    provider         String   @default("PLATFORM")
    is_default       Boolean  @default(false)
    is_deleted       Boolean  @default(false)
    created_by       String?
    updated_by       String?
    created_at       DateTime @default(now())
    updated_at       DateTime @default(now()) @updatedAt
    role_permissions Alchemi_RolePermissionTable[]
    workspace_members Alchemi_WorkspaceMemberTable[]
    @@unique([account_id, name])
    @@index([account_id])
    @@index([provider])
    @@index([is_default])
}

model Alchemi_PermissionTable {
    id                   String   @id @default(uuid())
    name                 String
    description          String?
    subject              String
    action               String
    is_system_permission Boolean  @default(false)
    fields               String[] @default([])
    conditions           String?
    created_by           String?
    updated_by           String?
    created_at           DateTime @default(now())
    updated_at           DateTime @default(now()) @updatedAt
    role_permissions     Alchemi_RolePermissionTable[]
    @@index([subject])
    @@index([action])
    @@index([name])
    @@index([subject, action])
}

model Alchemi_RolePermissionTable {
    id            String   @id @default(uuid())
    role_id       String
    permission_id String
    created_at    DateTime @default(now())
    role          Alchemi_RoleTable       @relation(fields: [role_id], references: [id], onDelete: Cascade)
    permission    Alchemi_PermissionTable @relation(fields: [permission_id], references: [id], onDelete: Cascade)
    @@unique([role_id, permission_id])
    @@index([role_id])
    @@index([permission_id])
}

// ============================================
// Alchemi Centralized Platform - Workspaces
// ============================================

model Alchemi_WorkspaceTable {
    id                     String   @id @default(uuid())
    account_id             String?
    name                   String
    description            String?
    status                 String   @default("ACTIVE")
    current_analysis_state String?
    is_mvp_ready           Boolean  @default(false)
    product_info           Json     @default("{}")
    workspace_info         Json     @default("{}")
    analysis_data          Json     @default("{}")
    created_by             String?
    updated_by             String?
    created_at             DateTime @default(now())
    updated_at             DateTime @default(now()) @updatedAt
    members                Alchemi_WorkspaceMemberTable[]
    discussions            Alchemi_DiscussionTable[]
    mvp_configs            Alchemi_MvpConfigTable[]
    connections            Alchemi_ConnectionTable[]
    mcp_configs            Alchemi_McpConfigTable[]
    @@index([account_id])
    @@index([name])
    @@index([status])
}

model Alchemi_WorkspaceMemberTable {
    id           String   @id @default(uuid())
    account_id   String?
    workspace_id String
    user_id      String
    role_id      String?
    status       String   @default("ACTIVE")
    created_by   String?
    updated_by   String?
    created_at   DateTime @default(now())
    updated_at   DateTime @default(now()) @updatedAt
    workspace    Alchemi_WorkspaceTable @relation(fields: [workspace_id], references: [id], onDelete: Cascade)
    role         Alchemi_RoleTable?     @relation(fields: [role_id], references: [id])
    @@unique([workspace_id, user_id])
    @@index([account_id])
    @@index([user_id])
    @@index([workspace_id])
    @@index([role_id])
    @@index([status])
}

// ============================================
// Alchemi Centralized Platform - Agent Registry
// ============================================

model Alchemi_AgentDefTable {
    agent_id              String   @id
    name                  String
    description           String?
    prompt                String?
    page                  String?
    categories            Json     @default("{}")
    tags                  String[] @default([])
    builtin_tools         String[] @default([])
    tools_mcp_ids         String[] @default([])
    tools_openapi_ids     String[] @default([])
    links                 Json     @default("{}")
    is_singleton          Boolean  @default(false)
    is_non_conversational Boolean  @default(false)
    status                String   @default("active")
    availability          String[] @default(["platform"])
    provider              String   @default("PLATFORM")
    account_id            String?
    created_at            DateTime @default(now())
    updated_at            DateTime @default(now()) @updatedAt
    marketplace_listings  Alchemi_AgentMarketplaceTable[]
    group_memberships     Alchemi_AgentGroupMemberTable[]
    @@index([account_id])
    @@index([name])
    @@index([page])
    @@index([status])
    @@index([provider])
}

model Alchemi_AgentGroupTable {
    id          String   @id @default(uuid())
    group_code  String   @unique
    name        String
    description String?
    group_type  String
    metadata    Json     @default("{}")
    status      String   @default("active")
    account_id  String?
    created_at  DateTime @default(now())
    updated_at  DateTime @default(now()) @updatedAt
    members     Alchemi_AgentGroupMemberTable[]
    @@index([account_id])
    @@index([group_code])
    @@index([group_type])
    @@index([status])
}

model Alchemi_AgentGroupMemberTable {
    id            String   @id @default(uuid())
    group_id      String
    agent_id      String
    display_order Int      @default(0)
    metadata      Json     @default("{}")
    account_id    String?
    created_at    DateTime @default(now())
    updated_at    DateTime @default(now()) @updatedAt
    group         Alchemi_AgentGroupTable @relation(fields: [group_id], references: [id], onDelete: Cascade)
    agent         Alchemi_AgentDefTable   @relation(fields: [agent_id], references: [agent_id], onDelete: Cascade)
    @@unique([group_id, agent_id])
    @@index([account_id])
    @@index([group_id])
    @@index([agent_id])
}

model Alchemi_AgentMarketplaceTable {
    id             String   @id @default(uuid())
    agent_id       String
    listing_status String   @default("draft")
    listing_data   Json     @default("{}")
    account_id     String?
    created_at     DateTime @default(now())
    updated_at     DateTime @default(now()) @updatedAt
    agent          Alchemi_AgentDefTable @relation(fields: [agent_id], references: [agent_id])
    @@index([account_id])
    @@index([agent_id])
    @@index([listing_status])
}

// ============================================
// Alchemi Centralized Platform - Guardrails
// ============================================

model Alchemi_GuardrailsConfigTable {
    id              String   @id @default(uuid())
    account_id      String?
    guard_type      String
    enabled         Boolean  @default(true)
    execution_order Int      @default(1)
    action_on_fail  String   @default("block")
    config          Json     @default("{}")
    version         Int      @default(1)
    created_by      String?
    updated_by      String?
    created_at      DateTime @default(now())
    updated_at      DateTime @default(now()) @updatedAt
    @@unique([account_id, guard_type])
    @@index([account_id])
    @@index([enabled])
}

model Alchemi_GuardrailsCustomPatternTable {
    id           String   @id @default(uuid())
    account_id   String?
    guard_type   String
    pattern_name String
    pattern      String
    description  String?
    enabled      Boolean  @default(true)
    created_by   String?
    created_at   DateTime @default(now())
    updated_at   DateTime @default(now()) @updatedAt
    @@index([account_id])
    @@index([guard_type])
}

model Alchemi_GuardrailsAuditLogTable {
    id            String   @id @default(uuid())
    account_id    String?
    guard_type    String
    action        String
    result        String
    request_data  Json?
    response_data Json?
    user_id       String?
    created_at    DateTime @default(now())
    @@index([account_id])
    @@index([guard_type])
    @@index([created_at])
    @@index([user_id])
}

// ============================================
// Alchemi Centralized Platform - Configuration
// ============================================

model Alchemi_ConfigProviderTable {
    id               String   @id
    name             String
    display_label    String?
    endpoint_env_var String?
    api_key_env_var  String?
    is_active        Boolean  @default(true)
    account_id       String?
    created_at       DateTime @default(now())
    updated_at       DateTime @default(now()) @updatedAt
    config_models    Alchemi_ConfigModelTable[]
    @@index([account_id])
    @@index([is_active])
}

model Alchemi_ConfigModelTable {
    id                      String   @id
    provider_id             String
    deployment_name         String
    display_name            String?
    capability              String?
    input_cost_per_million  Float    @default(0)
    output_cost_per_million Float    @default(0)
    content_capabilities    Json     @default("{}")
    extra_body              Json     @default("{}")
    sort_order              Int      @default(0)
    is_active               Boolean  @default(true)
    account_id              String?
    created_at              DateTime @default(now())
    updated_at              DateTime @default(now()) @updatedAt
    provider                Alchemi_ConfigProviderTable @relation(fields: [provider_id], references: [id])
    @@index([account_id])
    @@index([provider_id])
    @@index([is_active])
    @@index([capability])
}

model Alchemi_ConfigDefaultModelTable {
    id         String   @id
    model_id   String
    account_id String?
    created_at DateTime @default(now())
    updated_at DateTime @default(now()) @updatedAt
    @@index([account_id])
}

model Alchemi_ConfigSandboxPricingTable {
    id             String    @id @default(uuid())
    resource_type  String
    unit           String
    cost_usd       Float
    description    String?
    effective_from DateTime  @default(now())
    effective_to   DateTime?
    account_id     String?
    created_at     DateTime  @default(now())
    updated_at     DateTime  @default(now()) @updatedAt
    @@index([account_id])
    @@index([resource_type])
    @@index([effective_to])
}

// ============================================
// Alchemi Centralized Platform - Integrations & Connections
// ============================================

model Alchemi_ConnectionTable {
    id             String   @id @default(uuid())
    account_id     String?
    workspace_id   String?
    name           String
    type           String
    status         String   @default("ACTIVE")
    config         Json     @default("{}")
    mvp_version_id String?
    created_by     String?
    updated_by     String?
    created_at     DateTime @default(now())
    updated_at     DateTime @default(now()) @updatedAt
    workspace      Alchemi_WorkspaceTable? @relation(fields: [workspace_id], references: [id])
    mvp_version    Alchemi_MvpConfigTable? @relation(fields: [mvp_version_id], references: [id])
    @@index([account_id])
    @@index([workspace_id])
    @@index([type])
    @@index([status])
}

model Alchemi_IntegrationConnectionTable {
    id                            String   @id @default(uuid())
    workspace_id                  String
    user_id                       String?
    connection_level              String   @default("WORKSPACE")
    name                          String
    description_for_agent         String?
    integration_type              String
    app_name                      String
    composio_entity_id            String
    composio_connected_account_id String?
    status                        String   @default("active")
    connected_at                  DateTime @default(now())
    connected_by_user_id          String
    account_id                    String?
    updated_at                    DateTime @default(now()) @updatedAt
    @@unique([workspace_id, app_name, user_id])
    @@index([account_id])
    @@index([workspace_id])
    @@index([user_id])
    @@index([composio_entity_id])
    @@index([status])
}

model Alchemi_IntegrationsDefTable {
    id             String   @id
    name           String
    description    String?
    toolkit        String
    auth_config_id String
    icon           String?
    color          String?
    bg_color       String?
    enabled        Boolean  @default(true)
    display_order  Int      @default(0)
    created_at     DateTime @default(now())
    updated_at     DateTime @default(now()) @updatedAt
    @@index([toolkit])
    @@index([enabled])
}

// ============================================
// Alchemi Centralized Platform - Financial (Budget & Cost)
// ============================================

model Alchemi_BudgetPlanTable {
    id             String   @id @default(uuid())
    account_id     String?
    name           String   @default("Default Plan")
    is_active      Boolean  @default(true)
    distribution   Json     @default("{}")
    created_at     DateTime @default(now())
    updated_at     DateTime @default(now()) @updatedAt
    credit_budgets Alchemi_CreditBudgetTable[]
    @@index([account_id])
    @@index([is_active])
}

model Alchemi_CreditBudgetTable {
    id             String    @id @default(uuid())
    account_id     String?
    budget_plan_id String?
    scope_type     String
    scope_id       String
    allocated      Float     @default(0)
    limit_amount   Float     @default(0)
    overflow_cap   Float?
    used           Float     @default(0)
    overflow_used  Float     @default(0)
    cycle_start    DateTime
    cycle_end      DateTime
    created_at     DateTime  @default(now())
    updated_at     DateTime  @default(now()) @updatedAt
    budget_plan    Alchemi_BudgetPlanTable? @relation(fields: [budget_plan_id], references: [id])
    @@unique([scope_type, scope_id, cycle_start])
    @@index([account_id])
    @@index([scope_type, scope_id])
    @@index([cycle_start, cycle_end])
}

model Alchemi_CostTrackingTable {
    id                Int      @id @default(autoincrement())
    workspace_id      String
    account_id        String?
    user_id           String
    model             String
    tool              String
    cost              Float
    prompt_tokens     Int?
    completion_tokens Int?
    total_tokens      Int?
    metadata          Json?
    thread_id         String?
    created_at        DateTime @default(now())
    @@index([account_id])
    @@index([workspace_id])
    @@index([user_id])
    @@index([workspace_id, user_id])
    @@index([created_at])
    @@index([workspace_id, created_at])
    @@index([thread_id])
}

// ============================================
// Alchemi Centralized Platform - Platform Catalog & Override Configs
// ============================================

model Alchemi_PlatformCatalogTable {
    code          String   @id
    name          String
    category      String
    parent_code   String?
    value_config  Json     @default("{}")
    is_active     Boolean  @default(true)
    display_order Int      @default(0)
    created_at    DateTime @default(now())
    updated_at    DateTime @default(now()) @updatedAt
    parent        Alchemi_PlatformCatalogTable?  @relation("CatalogHierarchy", fields: [parent_code], references: [code])
    children      Alchemi_PlatformCatalogTable[] @relation("CatalogHierarchy")
    @@index([category])
    @@index([parent_code])
    @@index([is_active])
}

model Alchemi_AccountOverrideConfigTable {
    id                 String    @id @default(uuid())
    account_id         String?
    product_code       String?
    feature_code       String?
    entity_code        String
    name               String
    category           String
    parent_entity_code String?
    distribution_kind  String?
    action             String    @default("RESTRICT")
    inherit            Boolean   @default(true)
    value_config       Json      @default("{}")
    scope_type         String    @default("ACCOUNT")
    scope_id           String?
    restriction_json   Json?
    reason             String?
    valid_from         DateTime  @default(now())
    valid_until        DateTime?
    created_by         String?
    updated_by         String?
    created_at         DateTime  @default(now())
    updated_at         DateTime  @default(now()) @updatedAt
    @@unique([account_id, entity_code, scope_type])
    @@index([account_id])
    @@index([entity_code])
    @@index([category])
    @@index([scope_type, scope_id])
    @@index([valid_from, valid_until])
}

model Alchemi_MvpConfigTable {
    id             String   @id @default(uuid())
    account_id     String?
    workspace_id   String?
    name           String
    description    String?  @default("")
    creation_type  String   @default("default")
    mvp_type       String   @default("simple")
    framework      String   @default("nextjs")
    commit_count   Int      @default(0)
    connections    Json     @default("{}")
    base_versions  Json     @default("[]")
    config         Json     @default("{}")
    access_token   String?
    created_by     String?
    updated_by     String?
    created_at     DateTime @default(now())
    updated_at     DateTime @default(now()) @updatedAt
    workspace      Alchemi_WorkspaceTable? @relation(fields: [workspace_id], references: [id])
    mvp_connections Alchemi_ConnectionTable[]
    mcp_configs    Alchemi_McpConfigTable[]
    @@unique([account_id, name])
    @@index([account_id])
    @@index([workspace_id])
}

model Alchemi_McpConfigTable {
    id             String   @id @default(uuid())
    account_id     String?
    workspace_id   String?
    name           String
    server_name    String
    config         Json     @default("{}")
    is_active      Boolean  @default(true)
    mvp_version_id String?
    created_by     String?
    updated_by     String?
    created_at     DateTime @default(now())
    updated_at     DateTime @default(now()) @updatedAt
    workspace      Alchemi_WorkspaceTable? @relation(fields: [workspace_id], references: [id])
    mvp_version    Alchemi_MvpConfigTable? @relation(fields: [mvp_version_id], references: [id])
    @@index([account_id])
    @@index([workspace_id])
    @@index([is_active])
    @@index([server_name])
}

// ============================================
// Alchemi Centralized Platform - Communication & Support
// ============================================

model Alchemi_NotificationTable {
    id           String    @id @default(uuid())
    account_id   String?
    recipient_id String
    type         String
    title        String
    content      String
    status       String    @default("PENDING")
    read_at      DateTime?
    sent_at      DateTime?
    metadata     Json      @default("{}")
    created_by   String?
    created_at   DateTime  @default(now())
    updated_at   DateTime  @default(now()) @updatedAt
    @@index([account_id])
    @@index([recipient_id])
    @@index([account_id, recipient_id])
    @@index([type])
    @@index([status])
    @@index([created_at])
}

model Alchemi_NotificationTemplateTable {
    id               String   @id @default(uuid())
    template_id      String?  @unique
    title_line       String?
    template_content String?
    event_id         String?
    type             String?
    created_by       String?
    updated_by       String?
    created_at       DateTime @default(now())
    updated_at       DateTime @default(now()) @updatedAt
    @@index([event_id])
    @@index([type])
}

model Alchemi_AccountNotificationTemplateTable {
    id          String   @id @default(uuid())
    account_id  String?
    template_id String
    overrides   Json     @default("{}")
    is_active   Boolean  @default(true)
    created_at  DateTime @default(now())
    updated_at  DateTime @default(now()) @updatedAt
    @@unique([account_id, template_id])
    @@index([account_id])
}

model Alchemi_DiscussionTable {
    id                 String    @id @default(uuid())
    account_id         String?
    workspace_id       String?
    type               String
    content            String
    parent_object_type String?
    parent_object_id   String?
    parent_message_id  String?
    resolved           Boolean   @default(false)
    resolved_at        DateTime?
    resolved_by        String?
    mentions           String[]  @default([])
    attachments        String[]  @default([])
    reactions          Json      @default("[]")
    created_by         String?
    updated_by         String?
    created_at         DateTime  @default(now())
    updated_at         DateTime  @default(now()) @updatedAt
    workspace          Alchemi_WorkspaceTable?  @relation(fields: [workspace_id], references: [id])
    parent_message     Alchemi_DiscussionTable?  @relation("DiscussionThread", fields: [parent_message_id], references: [id])
    replies            Alchemi_DiscussionTable[] @relation("DiscussionThread")
    @@index([account_id])
    @@index([workspace_id])
    @@index([parent_object_type, parent_object_id])
    @@index([parent_message_id])
    @@index([resolved])
}

model Alchemi_UserInviteTable {
    id              String    @id @default(uuid())
    account_id      String?
    workspace_id    String?
    email           String
    role_id         String?
    status          String    @default("PENDING")
    token           String    @unique
    expires_at      DateTime
    accepted_at     DateTime?
    accepted_by     String?
    invitation_data Json      @default("{}")
    created_by      String?
    created_at      DateTime  @default(now())
    updated_at      DateTime  @default(now()) @updatedAt
    @@index([account_id])
    @@index([workspace_id])
    @@index([email])
    @@index([status])
    @@index([expires_at])
}

model Alchemi_SupportTicketTable {
    id              String   @id @default(uuid())
    account_id      String?
    user_profile_id String?
    subject         String
    description     String
    status          String?  @default("OPEN")
    priority        String   @default("MEDIUM")
    assigned_to     String?
    created_by      String?
    updated_by      String?
    created_at      DateTime @default(now())
    updated_at      DateTime @default(now()) @updatedAt
    @@index([account_id])
    @@index([user_profile_id])
    @@index([status])
    @@index([priority])
    @@index([assigned_to])
    @@index([account_id, status])
}

model Alchemi_AccessTokenTable {
    id           String    @id @default(uuid())
    account_id   String?
    name         String
    workspace_ids String[] @default([])
    token_hash   String    @unique
    client_id    String?
    scopes       String[]  @default([])
    last_used_at DateTime?
    expires_at   DateTime?
    revoked      Boolean   @default(false)
    created_by   String?
    updated_by   String?
    created_at   DateTime  @default(now())
    updated_at   DateTime  @default(now()) @updatedAt
    @@index([account_id])
    @@index([client_id])
    @@index([revoked])
    @@index([expires_at])
}

// ============================================
// Alchemi - Users, Groups, Teams
// ============================================

model Alchemi_UserTable {
    id                 String   @id @default(uuid())
    email              String   @unique
    name               String
    profile_image      String?
    ad_user_id         String?  @unique
    is_active          Boolean  @default(true)
    email_verified     Boolean  @default(false)
    global_preferences Json     @default("{}")
    created_at         DateTime @default(now())
    updated_at         DateTime @default(now()) @updatedAt
    @@map("users")
}

model Alchemi_GroupTable {
    id            String   @id @default(uuid())
    account_id    String
    name          String
    description   String?
    is_default    Boolean  @default(false)
    owner_id      String?
    contact_email String?
    created_by    String?
    updated_by    String?
    created_at    DateTime @default(now())
    updated_at    DateTime @default(now()) @updatedAt
    @@unique([account_id, name])
    @@index([account_id])
    @@index([owner_id])
    @@map("groups")
}

model Alchemi_TeamTable {
    id            String   @id @default(uuid())
    group_id      String
    name          String
    description   String?
    is_default    Boolean  @default(false)
    owner_id      String?
    contact_email String?
    created_by    String?
    updated_by    String?
    created_at    DateTime @default(now())
    updated_at    DateTime @default(now()) @updatedAt
    @@unique([group_id, name])
    @@index([group_id])
    @@index([owner_id])
    @@map("teams")
}

model Alchemi_AccountConnectionTable {
    id                  String   @id @default(uuid())
    account_id          String
    connection_type     String
    name                String
    description         String?
    description_for_agent String?
    connection_data     Json     @default("{}")
    is_active           Boolean  @default(true)
    is_default          Boolean  @default(false)
    metadata            Json     @default("{}")
    created_by          String?
    updated_by          String?
    created_at          DateTime @default(now())
    updated_at          DateTime @default(now()) @updatedAt
    @@unique([account_id, name])
    @@index([account_id])
    @@index([account_id, connection_type])
    @@map("account_connections")
}